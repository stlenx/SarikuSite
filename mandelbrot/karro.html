<html>
<head>

</head>
<body style="background: gray">

<script src="../dist/gpu-browser.js"></script>

<canvas id="canvas" width="1000" height="1000" style="border:1px solid #000;">
</canvas>

<script>
    const gpu = new GPU();
    const kernel = gpu.createKernel(function(factor, xOffset, yOffset) {

        let xOff = xOffset / factor;
        let yOff = yOffset / factor;

        let zReal = 0;
        let zImaginary = 0;

        let cReal = this.thread.x / factor + xOff;
        let cImaginary = this.thread.y / factor + yOff;

        let iterations = 0;
        while(Math.sqrt(zReal*zReal + zImaginary*zImaginary) <= 2 && iterations < 254){
            let tempReal = zReal*zReal + -zImaginary*zImaginary;
            let tempImaginary = zReal*zImaginary*2;
            zReal = tempReal + cReal;
            zImaginary = tempImaginary + cImaginary;
            iterations++;
        }

        if(Math.sqrt(zReal*zReal + zImaginary*zImaginary) <= 2)
            return 255;
        return iterations
    }).setOutput([1000, 1000])

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    const imageData = ctx.createImageData(1000, 1000);
    const data = imageData.data;

    pixels = kernel(1000, -1500, -500)

    for(let x = 0; x < 1000; x++){
        for(let y = 0; y < 1000; y++){
            const index = (y + x * 1000) * 4;
            const iterations = pixels[x][y];
            if(iterations != 255) {
                data[index] = iterations;
                data[index+1] = iterations;
                data[index+2] = iterations;
            }
            data[index+3] = 255;
        }
    }

    ctx.putImageData(imageData, 0, 0);
</script>
</body>
</html>